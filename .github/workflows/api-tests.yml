name: Postman API Tests

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]
  workflow_dispatch:

jobs:
  api-tests:
    runs-on: ubuntu-latest
    
    steps:
      - name: ğŸ“¥ Checkout code
        uses: actions/checkout@v3
        
      - name: âš™ï¸ Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'
          
      - name: ğŸ“¦ Install Newman
        run: npm install -g newman newman-reporter-htmlextra
          
      - name: ğŸ§ª Run Newman tests with explicit report path
        run: |
          echo "=== EJECUTANDO PRUEBAS ==="
          # Crear carpeta para reportes
          mkdir -p reports
          
          # Ejecutar y guardar reporte en carpeta especÃ­fica
          newman run NewCollection.postman_collection.json \
            -e qa_enviroment.postman_environment.json \
            -r htmlextra,cli \
            --reporter-htmlextra-export "reports/api-test-report.html" \
            --reporter-htmlextra-title "API Test Report - $(date '+%Y-%m-%d %H:%M')" \
            --reporter-htmlextra-darkTheme \
            --verbose
          
          # Verificar si se creÃ³ el reporte
          echo "=== VERIFICANDO REPORTE ==="
          ls -la reports/

      - name: ğŸ“Š Upload HTML report
        uses: actions/upload-artifact@v4
        if: always()
        with:
          name: api-test-report
          path: reports/api-test-report.html
          
      - name: ğŸ“‹ Show summary
        run: |
          echo "=== RESUMEN DE EJECUCIÃ“N ==="
          echo "âœ… Pruebas completadas exitosamente"
          echo "ğŸ“ Reporte guardado en: reports/api-test-report.html"
